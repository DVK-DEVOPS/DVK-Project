FROM golang:1.25.3 AS builder
WORKDIR /whoknows

COPY go/go.mod go/go.sum ./
RUN go mod download

RUN apt-get update && \
    apt-get install -y --no-install-recommends git openssh-client ca-certificates && \
    rm -rf /var/lib/apt/lists/*

RUN go install github.com/air-verse/air@v1.63.0
ENV PATH="/root/go/bin:${PATH}"

COPY go/. .

EXPOSE 8080
CMD ["go", "run", "-tags fts5", "main.go"]